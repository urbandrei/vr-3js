import{S as m,a as l,W as u,ak as p,al as w,am as C,ao as f,n as i,M as g}from"./HandSegmentRenderer-uNxfcPXv.js";class y{constructor(e){this.scene=e,this.mesh=this._createMesh(),this.mesh.visible=!1,e.add(this.mesh)}_createMesh(){const e=new m(.075,16,12),s=new l({color:8965256,roughness:.6,metalness:.1});return new u(e,s)}updateHead(e){if(!e){this.mesh.visible=!1;return}this.mesh.visible=!0,e.position&&this.mesh.position.set(e.position.x,e.position.y,e.position.z),e.rotation&&this.mesh.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z)}dispose(){this.scene.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.dispose()}}class S{constructor(){this.scene=null,this.renderer=null,this.camera=null,this.handSegmentRenderer=null,this.headRenderer=null,this.statusEl=document.getElementById("status"),this.roomForm=document.getElementById("room-form"),this.hasCameraData=!1,this.roomCode=null}async start(e){this.roomCode=e,this.renderer=p(!1),this.camera=w();const s=C();this.scene=s.scene,this.handSegmentRenderer=new f(this.scene),this.headRenderer=new y(this.scene),this.setStatus("Connecting to host..."),await this._connectToHost(),window.addEventListener("resize",()=>this._onResize()),this.renderer.setAnimationLoop(()=>this.update())}async _connectToHost(){try{await i.joinAsCamera(this.roomCode),this.setStatus(`Connected to ${this.roomCode}! Waiting for camera data...`),i.on(g.WORLD_STATE,e=>{this._onWorldState(e)}),i.on("disconnected",()=>{this.setStatus("Disconnected from host")})}catch(e){this.setStatus("Failed to connect: "+e.message),console.error("Connection failed:",e)}}_onWorldState(e){e.vrHands&&this.handSegmentRenderer.updateHands(e.vrHands),e.vrHead&&this.headRenderer.updateHead(e.vrHead),e.cameraObject&&(this._updateCameraFromObject(e.cameraObject),this.hasCameraData||(this.hasCameraData=!0,this.setStatus("Camera active")))}_updateCameraFromObject(e){e.position&&this.camera.position.set(e.position.x,e.position.y,e.position.z),e.rotation&&this.camera.quaternion.set(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)}_onResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}setStatus(e){this.statusEl&&(this.statusEl.textContent=e)}update(){this.renderer.render(this.scene,this.camera)}}async function d(){const o=new S,e=document.getElementById("room-form"),s=document.getElementById("room-code-input"),h=document.getElementById("connect-btn"),n=document.getElementById("status"),r=new URLSearchParams(window.location.search).get("room");if(r){e.classList.add("hidden"),n.classList.remove("hidden");try{await o.start(r.toUpperCase())}catch(t){console.error("Failed to start camera view:",t),n.textContent="Failed to connect: "+t.message}return}const a=async()=>{const t=s.value.trim().toUpperCase();if(!t){alert("Please enter a room code");return}e.classList.add("hidden"),n.classList.remove("hidden"),n.textContent=`Connecting to room ${t}...`;try{await o.start(t)}catch(c){console.error("Failed to start camera view:",c),n.textContent="Failed to connect: "+c.message,e.classList.remove("hidden")}};h.addEventListener("click",a),s.addEventListener("keypress",t=>{t.key==="Enter"&&a()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d):d();
